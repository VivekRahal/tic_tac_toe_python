<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UK RICS Residential Survey Report</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header Section */
        .report-header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .report-title {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #fff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .report-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .rics-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            padding: 12px 25px;
            color: white;
            font-weight: 600;
        }

        /* Executive Summary Card */
        .executive-summary {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(25px);
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            color: white;
        }

        .summary-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .summary-icon {
            width: 60px;
            height: 60px;
            border-radius: 18px;
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
        }

        .summary-title {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .summary-text {
            font-size: 1.1rem;
            line-height: 1.8;
            color: rgba(255, 255, 255, 0.9);
        }

        /* Risk Assessment */
        .risk-assessment {
            display: flex;
            align-items: center;
            gap: 30px;
            margin-top: 30px;
            padding: 25px;
            background: rgba(255, 107, 53, 0.2);
            border-radius: 20px;
            border: 1px solid rgba(255, 107, 53, 0.3);
        }

        .risk-indicator {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff9a56, #ff6b35);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 800;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .risk-indicator::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: rotate 3s linear infinite;
        }

        .risk-info { flex: 1; }
        .risk-level { font-size: 1.5rem; font-weight: 700; color: white; margin-bottom: 8px; }
        .risk-description { color: rgba(255, 255, 255, 0.8); font-size: 1rem; }

        /* Main Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        /* Card Base Styles */
        .content-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(25px);
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 30px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            transition: all 0.4s ease;
            color: white;
        }

        .content-card:hover { transform: translateY(-10px); box-shadow: 0 35px 70px rgba(0, 0, 0, 0.3); }

        .card-header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
        .card-icon { width: 50px; height: 50px; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: white; }
        .findings-icon { background: linear-gradient(135deg, #ff6b35, #ee5a52); }
        .actions-icon { background: linear-gradient(135deg, #4CAF50, #43A047); }
        .keywords-icon { background: linear-gradient(135deg, #9C27B0, #7B1FA2); }
        .card-title { font-size: 1.4rem; font-weight: 600; }

        /* Findings List */
        .findings-list { list-style: none; padding: 0; }
        .finding-item { display: flex; align-items: flex-start; gap: 15px; margin-bottom: 20px; padding: 20px; background: rgba(255, 255, 255, 0.1); border-radius: 15px; border-left: 4px solid #ff6b35; transition: all 0.3s ease; }
        .finding-item:hover { background: rgba(255, 255, 255, 0.2); transform: translateX(5px); }
        .finding-icon { width: 30px; height: 30px; border-radius: 50%; background: linear-gradient(135deg, #ff6b35, #ee5a52); display: flex; align-items: center; justify-content: center; font-size: 0.9rem; color: white; flex-shrink: 0; }
        .finding-text { font-size: 1rem; color: rgba(255, 255, 255, 0.9); line-height: 1.6; }

        /* Actions List */
        .actions-list { list-style: none; padding: 0; }
        .action-item { display: flex; align-items: flex-start; gap: 15px; margin-bottom: 20px; padding: 20px; background: rgba(255, 255, 255, 0.1); border-radius: 15px; border-left: 4px solid #4CAF50; transition: all 0.3s ease; }
        .action-item:hover { background: rgba(255, 255, 255, 0.2); transform: translateX(5px); }
        .action-number { width: 30px; height: 30px; border-radius: 50%; background: linear-gradient(135deg, #4CAF50, #43A047); display: flex; align-items: center; justify-content: center; font-size: 0.9rem; font-weight: 600; color: white; flex-shrink: 0; }
        .action-text { font-size: 1rem; color: rgba(255, 255, 255, 0.9); line-height: 1.6; }

        /* Keywords Section */
        .keywords-container { display: flex; flex-wrap: wrap; gap: 12px; }
        .keyword-tag { background: rgba(255, 255, 255, 0.2); color: #fff; padding: 10px 18px; border-radius: 25px; font-size: 1rem; font-weight: 800; border: 1px solid rgba(255, 255, 255, 0.3); transition: all 0.3s ease; }
        .keyword-tag:hover { background: rgba(255, 255, 255, 0.3); transform: translateY(-2px); }
        .keyword-primary { background: linear-gradient(135deg, #9C27B0, #7B1FA2); }
        .keyword-secondary { background: linear-gradient(135deg, #4facfe, #00f2fe); }

        /* Stats Section */
        .stats-section { background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(25px); border-radius: 25px; border: 1px solid rgba(255, 255, 255, 0.2); padding: 40px; margin-bottom: 40px; box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2); color: white; }
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 30px; }
        .stat-item { text-align: center; padding: 25px; background: rgba(255, 255, 255, 0.1); border-radius: 20px; transition: all 0.3s ease; }
        .stat-item:hover { background: rgba(255, 255, 255, 0.2); transform: translateY(-5px); }
        .stat-icon { font-size: 2.5rem; margin-bottom: 15px; display: block; }
        .stat-value { font-size: 2rem; font-weight: 700; margin-bottom: 8px; }
        .stat-label { font-size: 0.9rem; color: rgba(255, 255, 255, 0.7); }

        /* Next Steps Section */
        .next-steps { background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(67, 160, 71, 0.1)); border: 1px solid rgba(76, 175, 80, 0.3); border-radius: 25px; padding: 40px; color: white; text-align: center; }
        .next-steps-title { font-size: 1.8rem; font-weight: 700; margin-bottom: 20px; color: #4CAF50; }
        .next-steps-text { font-size: 1.1rem; margin-bottom: 30px; color: rgba(255, 255, 255, 0.9); }
        .action-buttons { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; }
        .action-button { background: linear-gradient(135deg, #4CAF50, #43A047); color: white; border: none; border-radius: 25px; padding: 15px 30px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 10px 25px rgba(76, 175, 80, 0.3); }
        .action-button:hover { transform: translateY(-3px); box-shadow: 0 15px 35px rgba(76, 175, 80, 0.4); }
        .action-button.secondary { background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); box-shadow: none; }
        .action-button.secondary:hover { background: rgba(255, 255, 255, 0.3); }

        /* Animations */
        @keyframes rotate { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px);} to { opacity: 1; transform: translateY(0);} }
        .fade-in { animation: fadeInUp 0.6s ease-out; }

        /* Responsive Design */
        @media (max-width: 768px) {
            .report-title { font-size: 2rem; }
            .content-grid { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .risk-assessment { flex-direction: column; text-align: center; }
            .action-buttons { flex-direction: column; align-items: center; }
        }

        @media (max-width: 480px) {
            .stats-grid { grid-template-columns: 1fr; }
            .container { padding: 10px; }
            .content-card { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="report-header fade-in">
            <h1 class="report-title">üè† UK RICS Residential Survey Report</h1>
            <p class="report-subtitle">Professional Property Assessment & Analysis</p>
            <div class="rics-badge">
                <span>üèõÔ∏è</span>
                <span>RICS Certified Survey</span>
            </div>
            <div class="action-buttons" style="margin-top:16px;">
                <button class="action-button secondary" onclick="goBackToScan()">Back to Quick Scan</button>
            </div>
        </div>

        <!-- Uploaded Image (if available) -->
        <div class="content-card fade-in" id="image-card" style="display:none; text-align:center;">
            <img id="uploaded-image" alt="Uploaded property photo" style="max-width:100%; height:auto; border-radius:16px;" />
            <div id="image-caption" style="margin-top:8px; color:#fff; opacity:.9;">Uploaded Photo</div>
        </div>

        <!-- Executive Summary -->
        <div class="executive-summary fade-in">
            <div class="summary-header">
                <div class="summary-icon">üìä</div>
                <div class="summary-title">Executive Summary</div>
            </div>
            <div class="summary-text" id="summary-text">
                This image depicts a room with a visible damp issue, likely due to water ingress or poor ventilation. Affected areas include a window frame and part of the wall, indicating potential moisture damage.
            </div>
            
            <div class="risk-assessment">
                <div class="risk-indicator" id="risk-indicator">MODERATE</div>
                <div class="risk-info">
                    <div class="risk-level" id="risk-level">MODERATE RISK LEVEL</div>
                    <div class="risk-description">
                        Requires prompt attention to prevent escalation and structural damage
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="stats-section fade-in">
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-icon">üîç</span>
                    <div class="stat-value" id="stat-findings">2</div>
                    <div class="stat-label">Key Findings</div>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">‚úÖ</span>
                    <div class="stat-value" id="stat-actions">3</div>
                    <div class="stat-label">Recommended Actions</div>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">‚ö†Ô∏è</span>
                    <div class="stat-value" id="stat-risk">MOD</div>
                    <div class="stat-label">Risk Classification</div>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">üè∑Ô∏è</span>
                    <div class="stat-value" id="stat-keywords">6</div>
                    <div class="stat-label">Technical Keywords</div>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="content-grid">
            <!-- Findings Card -->
            <div class="content-card fade-in">
                <div class="card-header">
                    <div class="card-icon findings-icon">üîç</div>
                    <div class="card-title">Critical Findings</div>
                </div>
                <ul class="findings-list" id="findings-list"></ul>
            </div>

            <!-- Actions Card -->
            <div class="content-card fade-in">
                <div class="card-header">
                    <div class="card-icon actions-icon">‚úÖ</div>
                    <div class="card-title">Recommended Actions</div>
                </div>
                <ul class="actions-list" id="actions-list"></ul>
            </div>
            <!-- Issues Card (moved into grid, renamed from Technical Keywords) -->
            <div class="content-card fade-in">
                <div class="card-header">
                    <div class="card-icon keywords-icon">‚ùó</div>
                    <div class="card-title">Issues</div>
                </div>
                <div class="keywords-container" id="keywords-container"></div>
            </div>
        </div>
        

        <!-- Next Steps -->
        <div class="next-steps fade-in">
            <h2 class="next-steps-title">üöÄ Next Steps</h2>
            <p class="next-steps-text">
                Based on our professional assessment, immediate action is required to address the identified moisture issues. 
                We recommend engaging qualified specialists to implement the recommended remediation plan.
            </p>
            <div class="action-buttons">
                <button class="action-button" onclick="scheduleInspection()">Schedule Detailed Inspection</button>
                <button class="action-button secondary" onclick="downloadReport()">Download Full Report</button>
                <button class="action-button secondary" onclick="contactSpecialist()">Contact Specialist</button>
            </div>
        </div>
    </div>

    <script>
        // Helpers
        function dedupeStrings(arr){
            if (!Array.isArray(arr)) return []
            const seen = new Set(); const out = []
            for (const raw of arr){
                if (raw === undefined || raw === null) continue
                const s = String(raw).trim().replace(/\s+/g,' ')
                if (!s) continue
                const key = s.replace(/[\s\.,;:!]+$/,'').toLowerCase()
                if (!seen.has(key)) { seen.add(key); out.push(s) }
            }
            return out
        }

        // Sample JSON data structure (default input data)
        const surveyData = {
            "title": "UK RICS Residential Survey Report",
            "summary": "This image depicts a room with a visible damp issue, likely due to water ingress or poor ventilation. Affected areas include a window frame and part of the wall, indicating potential moisture damage.",
            "findings": [
                "Dampness and possible mould growth on the affected area",
                "Possible structural damage or instability caused by dampness"
            ],
            "recommended_actions": [
                "Thorough inspection for underlying water ingress or ventilation issues",
                "Prompt remedial action to address moisture damage and prevent further deterioration of the property's fabric",
                "Enhancement of ventilation in the area to mitigate future dampness"
            ],
            "risk_level": "moderate",
            "keywords": [
                "dampness","mould growth","water ingress","ventilation","property inspection","remedial action"
            ]
        };

        // Populate the report with JSON data
        function populateReport(data) {
            // Normalize & de-duplicate key fields
            data = data || {}
            data.title = (data.title || 'UK RICS Residential Survey Report').toString().trim()
            data.summary = (data.summary || '').toString().trim()
            data.findings = dedupeStrings(Array.isArray(data.findings) ? data.findings : [])
            data.recommended_actions = dedupeStrings(Array.isArray(data.recommended_actions) ? data.recommended_actions : [])
            data.keywords = dedupeStrings(Array.isArray(data.keywords) ? data.keywords : [])

            document.querySelector('.report-title').innerHTML = `üè† ${data.title || 'UK RICS Residential Survey Report'}`;
            document.getElementById('summary-text').textContent = data.summary || '';

            const risk = String(data.risk_level || 'moderate').toUpperCase();
            const riskIndicator = document.getElementById('risk-indicator');
            const riskLevelEl = document.getElementById('risk-level');
            riskIndicator.textContent = risk;
            riskLevelEl.textContent = `${risk} RISK LEVEL`;
            if ((data.risk_level || '').toLowerCase() === 'high') {
                riskIndicator.style.background = 'linear-gradient(135deg, #ff6b6b, #ee5a52)';
            } else if ((data.risk_level || '').toLowerCase() === 'low') {
                riskIndicator.style.background = 'linear-gradient(135deg, #51cf66, #40c057)';
            }

            document.getElementById('stat-findings').textContent = (data.findings || []).length;
            document.getElementById('stat-actions').textContent = (data.recommended_actions || []).length;
            document.getElementById('stat-risk').textContent = risk.substring(0,3);
            document.getElementById('stat-keywords').textContent = (data.keywords || []).length;

            const findingsList = document.getElementById('findings-list');
            findingsList.innerHTML = '';
            (data.findings || []).forEach((finding, index) => {
                const li = document.createElement('li');
                li.className = 'finding-item';
                li.innerHTML = `<div class="finding-icon">${index + 1}</div><div class="finding-text"><strong>${finding.split(' ').slice(0, 3).join(' ')}:</strong> ${finding}</div>`;
                findingsList.appendChild(li);
            });

            const actionsList = document.getElementById('actions-list');
            actionsList.innerHTML = '';
            (data.recommended_actions || []).forEach((action, index) => {
                const li = document.createElement('li');
                li.className = 'action-item';
                li.innerHTML = `<div class="action-number">${index + 1}</div><div class="action-text"><strong>${action.split(' ').slice(0, 2).join(' ')}:</strong> ${action}</div>`;
                actionsList.appendChild(li);
            });

            const keywordsContainer = document.getElementById('keywords-container');
            keywordsContainer.innerHTML = '';
            (data.keywords || []).forEach((keyword, index) => {
                const span = document.createElement('span');
                span.className = `keyword-tag ${index < 2 ? 'keyword-primary' : index < 4 ? 'keyword-secondary' : ''}`;
                span.innerHTML = `<strong>${keyword.charAt(0).toUpperCase() + keyword.slice(1)}</strong>`;
                keywordsContainer.appendChild(span);
            });
            // Show uploaded image if present
            const imgData = localStorage.getItem('hs_last_image');
            const img = document.getElementById('uploaded-image');
            const card = document.getElementById('image-card');
            if (imgData) { img.src = imgData; card.style.display = 'block'; }
        }

        // Interactive functions
        function scheduleInspection() { alert('Redirecting to inspection scheduling system...'); }
        function downloadReport() { window.print(); }
        function contactSpecialist() { alert('Connecting you with certified RICS specialists...'); }
        function goBackToScan() { window.location.href = '/'; }

        // Initialize animations on scroll
        function initializeAnimations() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('fade-in'); });
            });
            document.querySelectorAll('.content-card, .stats-section, .next-steps').forEach(el => observer.observe(el));
        }

        // Try to load data from localStorage if present (integrates with app flow)
        function loadFromStorage() {
            try {
                const raw = localStorage.getItem('hs_last_result');
                if (!raw) return null;
                const parsed = JSON.parse(raw);
                return parsed || null;
            } catch { return null; }
        }

        // Load raw text exactly as produced by the model
        function loadRaw() {
            try { return localStorage.getItem('hs_last_raw') || null } catch { return null }
        }

        // Render raw-only view with no additions
        function renderRawOnly(rawText) {
            const container = document.querySelector('.container')
            container.innerHTML = ''
            const pre = document.createElement('pre')
            pre.style.whiteSpace = 'pre-wrap'
            pre.style.background = '#ffffff'
            pre.style.padding = '16px'
            pre.style.borderRadius = '12px'
            pre.style.border = '1px solid #e5e7eb'
            pre.style.boxShadow = '0 10px 24px rgba(0,0,0,.12)'
            pre.textContent = rawText
            container.appendChild(pre)
        }

        document.addEventListener('DOMContentLoaded', function() {
            const raw = loadRaw()
            if (raw) {
                renderRawOnly(raw)
            } else {
                const data = loadFromStorage() || surveyData
                populateReport(data)
                initializeAnimations()
            }
        });

        // Print styles override
    </script>

    <!-- Print Styles -->
    <style media="print">
        body { background: white; color: black; }
        .content-card,
        .executive-summary,
        .stats-section,
        .next-steps { background: white; color: black; border: 1px solid #ccc; box-shadow: none; }
        .action-buttons { display: none; }
    </style>
</body>
</html>
